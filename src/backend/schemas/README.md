# Database Collection Schemas

This directory contains the JSON schema definitions for all Wix Data collections used in TTS Website V7.

## Schema Files

- **Portfolio.json** - Original paintings available in gallery
- **CustomCreations.json** - AI-generated artwork created by users
- **Orders.json** - Print orders (semi-manual Printify workflow)
- **PortalSessions.json** - Portal animation session tracking

## Using These Schemas

### Quick Setup

1. Open Wix Editor
2. Go to **CMS** > **Content Manager**
3. Click **Add Collection**
4. Use these JSON files as reference to:
   - Name your collection
   - Add fields with correct types
   - Set required/default values
   - Create indexes

### Schema File Format

Each schema file contains:

```json
{
  "collectionName": "CollectionName",
  "displayName": "Display Name",
  "description": "What this collection stores",
  "fields": [
    {
      "key": "fieldName",
      "type": "fieldType",
      "description": "What this field stores",
      "required": true/false,
      "default": "defaultValue"
    }
  ],
  "indexes": [
    {
      "name": "index_name",
      "fields": ["field1", "field2"],
      "description": "What this index optimizes"
    }
  ],
  "permissions": {
    "read": "Who can read",
    "write": "Who can write",
    "delete": "Who can delete"
  }
}
```

### Field Types

Wix supports these field types:

- `text` - Short text (up to 400 characters)
- `richText` - Long text with formatting
- `number` - Numeric values
- `boolean` - True/false
- `date` - Date and time
- `array` - Array of values
- `image` - Image URL
- `tags` - Array of tags
- `reference` - Reference to another collection

### System Fields

These fields are auto-generated by Wix:

- `_id` - Unique identifier
- `_createdDate` - Creation timestamp
- `_updatedDate` - Last update timestamp
- `_owner` - Owner user ID (if permissions enabled)

## Important Notes

### Do Not Import Directly

These JSON files are **documentation only**. Wix does not support direct schema import. You must manually create collections in the CMS interface using these files as reference.

### Index Creation

Indexes must be created manually after fields are added:

1. Select collection in CMS
2. Click **More Actions** > **Manage Indexes**
3. Add indexes as specified in schema file

### Permissions

Permissions are configured in `/src/backend/permissions.json` and applied through Wix Settings > Permissions.

## Validation

After creating collections, verify your setup:

```javascript
import wixData from 'wix-data';

// Test in Page Code
$w.onReady(async function () {
    try {
        // Test Portfolio
        const portfolio = await wixData.query('Portfolio').limit(1).find();
        console.log('✓ Portfolio collection exists');

        // Test CustomCreations
        const creations = await wixData.query('CustomCreations').limit(1).find();
        console.log('✓ CustomCreations collection exists');

        // Test Orders
        const orders = await wixData.query('Orders').limit(1).find();
        console.log('✓ Orders collection exists');

        // Test PortalSessions
        const sessions = await wixData.query('PortalSessions').limit(1).find();
        console.log('✓ PortalSessions collection exists');

        console.log('All collections verified!');
    } catch (error) {
        console.error('Collection verification failed:', error);
    }
});
```

## Migration & Backup

### Export Data

To export data from a collection:

```javascript
import wixData from 'wix-data';

export async function exportCollection(collectionName) {
    const allItems = [];
    let hasMore = true;
    let skip = 0;
    const limit = 1000;

    while (hasMore) {
        const results = await wixData.query(collectionName)
            .limit(limit)
            .skip(skip)
            .find();

        allItems.push(...results.items);
        hasMore = results.hasNext();
        skip += limit;
    }

    return allItems;
}
```

### Import Data

To import data into a collection:

```javascript
import wixData from 'wix-data';

export async function importCollection(collectionName, items) {
    const results = [];

    for (const item of items) {
        try {
            const inserted = await wixData.insert(collectionName, item);
            results.push({ success: true, id: inserted._id });
        } catch (error) {
            results.push({ success: false, error: error.message });
        }
    }

    return results;
}
```

## Schema Versioning

When modifying schemas:

1. Document changes in schema file
2. Update `DATABASE_SCHEMA.md`
3. Add migration notes if breaking changes
4. Test thoroughly before deploying

## Support

For questions or issues:

- See `/src/backend/DATABASE_SCHEMA.md` for detailed documentation
- Check Wix Data documentation: https://www.wix.com/velo/reference/wix-data
- Review `/ARCHITECTURE.md` for system architecture

---

**Last Updated**: 2025-11-15
**Status**: Ready for implementation
